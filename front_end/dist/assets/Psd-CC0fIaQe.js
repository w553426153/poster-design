import{co as e,cp as s,j as a,cq as t,r as l,ac as o,p as n,s as r,A as c,q as d,B as i,bZ as u,v as p,W as f,Y as g,c3 as v,c4 as m,bN as h,a5 as _,Q as P,X as w,O as y,T as b,cr as k,cs as D,ct as S,c0 as C,bT as F,bP as O}from"./index-CgHpowZ8.js";const U={}.VUE_APP_API_URL||"http://localhost:8000/api",x=e=>`${U}/files/${encodeURIComponent(e)}`,$=a({name:"PSDUploader",components:{UploadFilled:t},emits:["processed"],setup(a,{emit:t}){const o=l(!1),n=l(0),r=l(""),c=l(null),d=l(null),i=l(""),u=async a=>{try{o.value=!0,r.value="Uploading file...",i.value="";const l=await(async(a,t={},l)=>{const o=new FormData;o.append("file",a),"boolean"==typeof t.skipOcr&&o.append("skip_ocr",String(t.skipOcr)),o.append("output_format",t.outputFormat||"png"),o.append("return_canvas","true");try{const s=await e(`${U}/psd/process`,o,"post",{},{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(l&&e.total){const s=Math.round(100*e.loaded/e.total);l(s)}}});if("error"===s.status)throw new Error(s.message||"Failed to process PSD file");return s}catch(n){throw s.error(n.message||"Failed to process PSD file"),n}})(a,{skipOcr:!1,outputFormat:"png"},(e=>{n.value=Math.min(90,e)}));r.value="Processing file...",n.value=95,await new Promise((e=>setTimeout(e,500))),c.value=l,n.value=100,i.value="success",r.value="Processing complete!",s.success("PSD processed successfully"),t("processed",l)}catch(l){i.value="exception",r.value="Error processing file: "+(l.message||"Unknown error"),s.error("Failed to process PSD: "+(l.message||"Unknown error"))}finally{o.value=!1}};return{processing:o,progress:n,progressStatus:i,statusMessage:r,result:c,handleFileChange:e=>{var a,t;o.value=!1,n.value=0,r.value="",c.value=null,i.value="";const l=(null==e?void 0:e.raw)||e;if(!l)return s.error("无法读取文件，请重试"),!1;const p=(null==(t=null==(a=l.name)?void 0:a.toLowerCase)?void 0:t.call(a))||"";return p.endsWith(".psd")||p.endsWith(".psb")?l.size>20971520?(s.error("File size should not exceed 20MB"),!1):(d.value=l,u(l),!1):(s.error("Only PSD files are supported"),!1)},downloadResult:()=>{var e,a;if(null==(e=c.value)?void 0:e.file_path){const e=((null==(a=d.value)?void 0:a.name)||"processed").replace(/\.(psd|psb)$/i,"_processed.png");((e,a)=>{try{const s=`${U}/psd/download/${encodeURIComponent(e)}`,t=document.createElement("a");t.href=s,t.download=a||e.split("/").pop()||"processed_file.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(t){throw s.error(t.message||"Failed to download file"),t}})(c.value.file_path,e)}}}}}),I=e=>(v("data-v-5aaddd9d"),e=e(),m(),e),M={class:"psd-uploader"},R=I((()=>p("div",{class:"el-upload__text"},[g(" Drop PSD file here or "),p("em",null,"click to upload")],-1))),W=I((()=>p("div",{class:"el-upload__tip"}," Only PSD files with a size less than 20MB ",-1))),j={key:0,class:"processing-container"},z={class:"status-message"},E={key:1,class:"result-container"};const N=o($,[["render",function(e,s,a,t,l,o){const v=u("upload-filled"),m=u("el-icon"),h=u("el-upload"),_=u("el-progress"),P=u("el-button"),w=u("el-result");return r(),n("div",M,[c(h,{class:"upload-demo",drag:"",action:"/","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":e.handleFileChange,accept:".psd,.psb"},{tip:i((()=>[W])),default:i((()=>[c(m,{class:"el-icon--upload"},{default:i((()=>[c(v)])),_:1}),R])),_:1},8,["on-change"]),e.processing?(r(),n("div",j,[c(_,{percentage:e.progress,status:e.progressStatus,"stroke-width":10},null,8,["percentage","status"]),p("div",z,f(e.statusMessage),1)])):d("",!0),e.result?(r(),n("div",E,[c(w,{icon:"success",title:"Processing Complete","sub-title":`File processed successfully: ${e.result.file_path}`},{extra:i((()=>[c(P,{type:"primary",onClick:e.downloadResult},{default:i((()=>[g(" Download Processed File ")])),_:1},8,["onClick"])])),_:1},8,["sub-title"])])):d("",!0)])}],["__scopeId","data-v-5aaddd9d"]]),T=e=>(v("data-v-3def59fd"),e=e(),m(),e),A={class:"psd-container"},B=T((()=>p("div",{class:"header"},[p("h1",null,"PSD 文件处理工具"),p("p",null,"上传 PSD 文件以移除文本图层并处理图像")],-1))),J={class:"content"},q={class:"features"},G=T((()=>p("h2",null,"功能特点",-1))),L={class:"feature-icon"},Q=o(a({__name:"Psd",setup(e){const s=[{title:"PSD 解析（后端）",description:"由后端统一解析与处理，结果可下载",component:k},{title:"智能去文字",description:"后端使用 OCR 检测并移除文本图层",component:D},{title:"多种格式导出",description:"支持 PNG、JPG 等图片格式导出",component:S}],a=C(),t=h(),l=_(),o={text:O,image:F};function d(e){try{const s=null==e?void 0:e.canvas;if(!s)return;const{width:n,height:r,background:c,clouds:d}=s;t.setDPage(Object.assign(t.dPage,{width:n,height:r,backgroundColor:(null==c?void 0:c.color)||"#ffffff00",backgroundImage:(null==c?void 0:c.image_url)?x(c.image_url):""})),l.setDWidgets([]);for(let e=0;e<((null==d?void 0:d.length)||0);e++){const s=d[e],a=JSON.parse(JSON.stringify(o[s.type]))||{};delete s.type,s.image_url&&(s.imgUrl=x(s.image_url)),l.addWidget(Object.assign(a,s))}a.push("/home")}catch(s){}}return(e,a)=>{const t=u("el-icon"),l=u("el-card"),o=u("el-col"),g=u("el-row");return r(),n("div",A,[B,p("div",J,[c(N,{onProcessed:d})]),p("div",q,[G,c(g,{gutter:20},{default:i((()=>[(r(),n(P,null,w(s,((e,s)=>c(o,{span:8,key:s},{default:i((()=>[c(l,{class:"feature-card"},{default:i((()=>[p("div",L,[c(t,{size:32},{default:i((()=>[(r(),y(b(e.component)))])),_:2},1024)]),p("h3",null,f(e.title),1),p("p",null,f(e.description),1)])),_:2},1024)])),_:2},1024))),64))])),_:1})])])}}}),[["__scopeId","data-v-3def59fd"]]);export{Q as default};
