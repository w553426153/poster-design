import{j as a,bY as e,bN as s,a5 as t,a6 as o,o as n,bO as i,b_ as d,bQ as l,ck as c,cl as g,p as r,s as f,v as p,A as u,cf as m,ch as w,ac as h}from"./index-Bm01IdcZ.js";import{P as v}from"./preload-Bq68wFsq.js";import{F as b}from"./fontfaceobserver.standalone-DSfWheX_.js";const y={ref:"pageDesignIndex"},x={class:"page-design-index-wrap"},C=h(a({__name:"Draw",setup(a){const h=d();e({style:{left:"0px"}});const C=s(),I=t(),{dPage:N}=o(C);return n((()=>{i((()=>{!async function(){var a;let e="",s=!1;const{id:t,tempid:o,tempType:n=0,index:d=0}=h.query;if(t||o){const f={id:t||o,type:Number(n)},{data:p,width:u,height:m}=await l.home[t?"getWorks":"getTempDetail"](f);let w=JSON.parse(p);const h=1==Number(n);if(Array.isArray(w)&&!h){const{global:a,layers:e}=w[d];w={page:a,widgets:e}}const y=h?w:w.widgets;h?(N.value.width=u,N.value.height=m,N.value.backgroundColor="#ffffff00",I.addGroup(w)):(C.setDPage(w.page),e=null==(a=w.page)?void 0:a.backgroundImage,e&&delete w.page.backgroundImage,C.setDPage(w.page),t?I.setDWidgets(y):I.setTemplate(y)),await i();const x=[],D=[],P=[],T={};let _=[];if(y.forEach((a=>{if(a.fontClass&&a.fontClass.value){const e=new b(a.fontClass.value);_.push(a.fontClass),P.push(e.load(null,3e4)),T[a.fontClass.value]?T[a.fontClass.value]+=a.text:T[a.fontClass.value]=a.text}try{if(a.svgUrl&&"w-svg"===a.type){const e=window.document.getElementById(a.uuid).childNodes;D.push(e)}else if(a.imgUrl&&!a.isNinePatch){const e=window.document.getElementById(a.uuid).childNodes;for(const a of e)a.className&&a.className.includes("img__box")&&x.push(a.firstChild)}}catch(e){}})),e){const a=new v([e]);await a.imgs(),C.setDPage({...w.page,backgroundImage:e})}try{c&&await g(T,_);const a=new v(x);await a.doms();const e=new v(D);await e.svgs()}catch(r){}try{await Promise.all(P)}catch(r){}s=!0,setTimeout((()=>{try{window.loadFinishToInject("done")}catch(a){}}),100)}setTimeout((()=>{!s&&window.loadFinishToInject("done")}),6e4)}()}))})),(a,e)=>(f(),r("div",y,[p("div",x,[u(m,{class:"page-design-wrap fixed-canvas",pageDesignCanvasId:"page-design-canvas"})]),u(w)],512))}}),[["__scopeId","data-v-f9e1819b"]]);export{C as default};
