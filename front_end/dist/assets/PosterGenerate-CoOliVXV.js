import{co as e,j as t,bZ as l,r as a,c as n,w as o,a5 as s,a as i,p as d,s as c,v as r,A as E,B as u,b_ as p,q as v,Q as B,X as m,y as A,W as b,Y as f,ab as g,O as h,cp as w,bV as y,a9 as C,u as D,cu as F,c9 as j,cq as k,c4 as U,c5 as _,c1 as x,cv as I,bT as V,bS as O,bO as $,ac as R}from"./index-BvGhcMKp.js";const L=[{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%202.webp",type:"产品类",title:"产品 2"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2014.webp",type:"产品类",title:"产品 14"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2018.webp",type:"产品类",title:"产品 18"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%201.webp",type:"品牌类",title:"品牌 1"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2019.webp",type:"产品类",title:"产品 19"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2015.webp",type:"产品类",title:"产品 15"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%203.webp",type:"产品类",title:"产品 3"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%208.webp",type:"产品类",title:"产品 8"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E8%8A%82%E6%B0%94%201.webp",type:"节气类",title:"节气 1"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%207.webp",type:"品牌类",title:"品牌 7"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%204.webp",type:"产品类",title:"产品 4"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2012.webp",type:"产品类",title:"产品 12"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2013.webp",type:"产品类",title:"产品 13"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%205.webp",type:"产品类",title:"产品 5"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%206.webp",type:"品牌类",title:"品牌 6"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%209.webp",type:"产品类",title:"产品 9"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%205.webp",type:"品牌类",title:"品牌 5"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E8%8A%82%E6%B0%94%203.webp",type:"节气类",title:"节气 3"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%209.webp",type:"品牌类",title:"品牌 9"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2010.webp",type:"产品类",title:"产品 10"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%206.webp",type:"产品类",title:"产品 6"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%207.webp",type:"产品类",title:"产品 7"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2011.webp",type:"产品类",title:"产品 11"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%208.webp",type:"品牌类",title:"品牌 8"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E8%8A%82%E6%B0%94%202.webp",type:"节气类",title:"节气 2"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%204.webp",type:"品牌类",title:"品牌 4"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2016.webp",type:"产品类",title:"产品 16"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%203.webp",type:"品牌类",title:"品牌 3"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E8%8A%82%E6%B0%94%204.webp",type:"节气类",title:"节气 4"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E5%93%81%E7%89%8C%202.webp",type:"品牌类",title:"品牌 2"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%201.webp",type:"产品类",title:"产品 1"},{url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%E4%BA%A7%E5%93%81%2017.webp",type:"产品类",title:"产品 17"},{title:"专属时刻，定格美好",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/jimeng-2025-11-17-9903-%E9%BB%91%E5%BA%95%E7%99%BD%E5%AD%97%EF%BC%8C%E4%B8%BB%E4%BD%93%E4%B8%BA%E7%8E%B0%E4%BB%A3%E8%89%BA%E6%9C%AF%E6%89%8B%E5%86%99%E5%88%9B%E6%84%8F%E5%AD%97%E4%BD%93%20%E2%80%9C%E4%B8%93%E5%B1%9E%E6%97%B6%E5%88%BB%EF%BC%8C%E5%AE%9A%E6%A0%BC%E7%BE%8E%E5%A5%BD%E2%80%9D%EF%BC%9B%E5%AD%97%E4%BD%93%E7%AC%94%E7%94%BB%E8%9E%8D%E5%90%88%E6%9F%94%E7%BE%8E%E6%9B%B2....png",type:"艺术字",prompt:"黑底白字，主体为现代艺术手写创意字体 “专属时刻，定格美好”；字体笔画融合柔美曲线与锐利直线，曲线飘逸延伸，直线挺拔利落；字形呈横向舒展且略带动态倾斜的布局，字间笔画相互呼应、富有视觉流动感；笔画粗细对比细腻（主笔稳重、辅笔纤细轻盈），线条边缘光滑自然；下方搭配纤细无衬线字体 “Have fun together.”；整体营造 浪漫细腻、心动时的轻盈艺术 氛围，突出字体的曲线韵律、动态布局与中英文风格融合的效果。"},{title:"山海",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/jimeng-2025-10-14-2637-%E7%8B%82%E9%87%8E%E8%B1%AA%E8%BF%88%E7%9A%84%E8%BF%9E%E4%BD%93%E4%B9%A6%E6%B3%95%E5%AD%97%E2%80%9C%E5%B1%B1%E6%B5%B7%E2%80%9D%EF%BC%8C%E7%AC%94%E7%94%BB%E6%B5%81%E7%95%85%E9%A3%98%E9%80%B8%EF%BC%8C%E5%9B%BD%E6%BD%AE%E9%A3%8E%E7%AC%94%E8%A7%A6%EF%BC%8C%E6%9E%81%E5%85%B7%E8%A7%86%E8%A7%89%E5%86%B2%E5%87%BB%E5%8A%9B%EF%BC%8C%E7%AC%94%E7%94%BB%E6%8B%89%E9%95%BF....png",type:"艺术字",prompt:"狂野豪迈的连体书法字“山海”，笔画流畅飘逸，国潮风笔触，极具视觉冲击力，笔画拉长变形出流畅的飞白，黑底白字。"},{title:"焕新启程 礼敬匠心",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/jimeng-2025-09-05-1208-%E6%A0%87%E9%A2%98%E5%AD%97%E4%BD%93%E8%AE%BE%E8%AE%A1%2C%E6%96%87%E5%AD%97%E2%80%9C%E7%84%95%E6%96%B0%E5%90%AF%E7%A8%8B%20%E7%A4%BC%E6%95%AC%E5%8C%A0%E5%BF%83%E2%80%9D%E6%9E%81%E5%85%B7%E4%B8%AA%E6%80%A7%E5%92%8C%E8%A1%97%E5%A4%B4%E6%84%9F%E7%9A%84%E6%B6%82%E9%B8%A6%E5%AD%97%E4%BD%93%EF%BC%8C%E5%85%85%E6%BB%A1%E5%8A%9B%E5%BA%A6%E4%B8%8E%E4%B8%8D....png",type:"艺术字",prompt:"标题字体设计,文字“焕新启程 礼敬匠心”极具个性和街头感的涂鸦字体，充满力度与不规则感流动的、跳跃的效果，字体大小、排版错落，白色字体，纯黑色背景。LOGO矢量"},{title:"超级开学季 625学院",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/jimeng-2025-11-13-1797-%E6%A0%87%E9%A2%98%E5%AD%97%E4%BD%93%E8%AE%BE%E8%AE%A1%EF%BC%8C%E5%A4%A7%E6%96%87%E5%AD%97%E2%80%9C%E8%B6%85%E7%BA%A7%E5%BC%80%E5%AD%A6%E5%AD%A3%20625%E5%AD%A6%E9%99%A2%E2%80%9D%EF%BC%8C%E5%B0%8F%E5%AD%97%E8%8B%B1%E6%96%87%E2%80%9CZHOUZHOU%E2%80%9D%EF%BC%8C%E8%A1%97....png",type:"艺术字",prompt:"标题字体设计，大文字“超级开学季 625学院”，小字英文“ZHOUZHOU”，街头涂鸦风格，笔画夸张变形，粗细对比强烈，不规则切割效果，字体流动跳跃，白色带多彩内色，蓝渐变线条装饰，暗蓝色双层厚度，多层描边，开学季元素抽象点缀，纯黑背景"},{title:"元气满满",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/jimeng-2025-11-11-2765-%E5%AD%97%E4%BD%93%EF%BC%8Clogo%E8%AE%BE%E8%AE%A1%EF%BC%8C%E6%BC%AB%E7%94%BB%E5%AD%97%E4%BD%93%EF%BC%8C%E5%AD%97%E4%BD%93%E5%86%85%E5%AE%B9%E2%80%9C%E5%85%83%E6%B0%94%E6%BB%A1%E6%BB%A1%E2%80%9D%EF%BC%8C%E6%BC%AB%E7%94%BB%E7%BA%B9%E7%90%86%EF%BC%8C%E8%83%96%E5%98%9F%E5%98%9F%E5%8F%AF%E7%88%B1%E6%84%9F%E8%A7%89%EF%BC%8C%E9%BB%91....png",type:"艺术字",prompt:"字体，logo设计，漫画字体，字体内容“元气满满”，漫画纹理，胖嘟嘟可爱感觉，黑色背景。卡通感十足"},{title:"夏日心跳，即刻启程！",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/jimeng-2025-07-16-5207-__%E6%96%87%E5%AD%97%E6%8E%92%E7%89%88%E8%AE%BE%E8%AE%A1%EF%BC%8C%E4%B8%AD%E6%96%87%E2%80%9C%E5%A4%8F%E6%97%A5%E5%BF%83%E8%B7%B3%EF%BC%8C%E5%8D%B3%E5%88%BB%E5%90%AF%E7%A8%8B%EF%BC%81%E2%80%9D%EF%BC%8C%E7%99%BD%E8%89%B2%E5%AD%97%E4%BD%93%EF%BC%8C%E8%93%9D%E8%89%B2%E5%8A%A0%E7%B2%97%E8%BE%B9%E7%BA%BF%EF%BC%8C%E8%BD%BB%E6%9D%BE%E5%A4%8F%E6%97%A5....png",type:"艺术字",prompt:"字体，logo设计，中文“夏日心跳，即刻启程！”，白色字体，蓝色加粗边线，轻松夏日风格，创意可爱体矢量插画，露营帐篷等小元素穿插字体中，创意字体设计Logo 纯黑背景"},{title:"森林探险",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/jimeng-2025-09-14-3322-%E5%AD%97%E4%BD%93%E8%AE%BE%E8%AE%A1%20%E2%80%9C%E6%A3%AE%E6%9E%97%E6%8E%A2%E9%99%A9%E2%80%9D%EF%BC%8C%E7%BA%AF%E9%BB%91%E8%89%B2%E8%83%8C%E6%99%AF%EF%BC%8C%E8%87%AA%E7%84%B6%E6%A3%AE%E6%9E%97%E6%9C%A8%E7%BA%B9%E5%AD%97%E4%BD%93%EF%BC%8C%E8%8B%94%E8%97%93%E5%8C%85%E8%A3%B9%E6%96%87%E5%AD%97%EF%BC%8C%E6%9C%A8%E8%B4%A8%E7%BA%B9%E7%90%86%EF%BC%8C%E8%A2%AB....png",type:"艺术字",prompt:"字体设计 “森林探险”，纯黑色背景，自然森林木纹字体，苔藓包裹文字，木质纹理，被藤蔓缠绕，创意写实，大师级构图"},{title:"夏日海边",url:"https://ennova-bigdata-test.obsv3.cn-lflt-1.enncloud.cn/video/model/wj/%20.png",type:"艺术字",prompt:"字体设计，大文字“夏日海边”，英文“Summer”极具个性和街头感的涂鸦字体，充满力度与不规则感流动的、跳跃的效果，多彩字体可以带点渐变,蓝色线条装饰，纯黑色背景，画面干净"}],z=e=>(U("data-v-3d050c08"),e=e(),_(),e),H={class:"poster-generate modal-mode"},P={class:"side-panel"},S=z((()=>r("div",{class:"panel-header"},[r("h3",null,"模版库"),r("span",{class:"subtitle"},"点击图片引用风格")],-1))),K={class:"tab-content-scroll","infinite-scroll-distance":50,"infinite-scroll-immediate":!0},T={class:"example-grid"},W=["onClick"],Z={class:"card-image"},q=["src","alt"],G=z((()=>r("div",{class:"card-overlay"},[r("span",{class:"use-btn"},"引用")],-1))),J={class:"card-title"},M={class:"scroll-status"},N={key:0,class:"no-more"},Q={key:1,class:"loading-more"},X={class:"chat-panel"},Y={key:0,class:"bubble loading-state"},ee={class:"loading-icon"},te={class:"loading-content"},le={class:"loading-text"},ae=z((()=>r("div",{class:"loading-bar"},null,-1))),ne={key:1,class:"bubble text-bubble"},oe={key:2,class:"bubble image-bubble"},se={class:"img-wrapper"},ie=["src"],de={class:"img-actions-grid"},ce={key:0,class:"reference-strip"},re={class:"strip-head"},Ee={class:"count"},ue=z((()=>r("span",{class:"strip-note"},"引用来自模板，底图来自上传",-1))),pe={key:0,class:"reference-list"},ve=["src"],Be={class:"chip-info"},me={class:"chip-title"},Ae=["onClick"],be={key:1,class:"reference-empty"},fe={class:"chat-input"},ge={class:"mode-toolbar inside"},he=z((()=>r("div",{class:"mode-title"},"模式",-1))),we={class:"mode-row"},ye={class:"summary-pill outlined"},Ce={class:"pill-ratio"},De=z((()=>r("span",{class:"pill-divider"},null,-1))),Fe={class:"pill-size"},je={class:"format-panel"},ke={class:"format-section"},Ue=z((()=>r("p",null,"选择比例",-1))),_e={class:"ratio-options"},xe={class:"format-section size-inputs"},Ie=z((()=>r("p",null,"尺寸 (px)",-1))),Ve={class:"size-row"},Oe=z((()=>r("span",null,"×",-1))),$e={class:"input-area"},Re={class:"chat-actions"},Le=R(t({__name:"PosterGenerate",setup(t){var U;const _=(y.API_URL&&y.API_URL.trim().length?y.API_URL:"undefined"!=typeof window?window.location.origin:"").replace(/\/$/,""),R=["产品类","品牌类","节气类","艺术字"],z=l([{id:crypto.randomUUID(),role:"ai",type:"text",content:"你好，我是海报生成助手。告诉我你的想法或上传参考图，我会给出建议。"}]),Le=a(""),ze=[{label:"文生图",value:"text"},{label:"参考图生成",value:"reference"},{label:"艺术字生成",value:"art"}],He=a("text"),Pe=["21:9","16:9","3:2","4:3","1:1","3:4","2:3","9:16"],Se={"1:1":{width:2048,height:2048},"4:3":{width:2304,height:1728},"3:2":{width:2496,height:1664},"16:9":{width:2560,height:1440},"21:9":{width:3024,height:1296}},Ke=l({ratio:"16:9",width:1024,height:768}),Te=a(!1),We=a(!1),Ze=a(null),qe=a(null),Ge=a([]),Je=a(null),Me=l((()=>{const e={"产品类":[],"品牌类":[],"节气类":[],"艺术字":[]};return L.forEach(((t,l)=>{e[t.type]&&e[t.type].push({id:`${t.type}-${l}`,title:t.title,cover:t.url,prompt:t.prompt})})),R.map((t=>({id:t,name:t,examples:e[t]||[]})))})()),Ne=a((null==(U=Me[0])?void 0:U.id)||"产品类"),Qe=l({});Me.forEach((e=>Qe[e.id]=10));const Xe=n((()=>Me.find((e=>e.id===Ne.value)))),Ye=n((()=>{const e=Xe.value;if(!e)return[];const t=Qe[e.id]||10;return e.examples.slice(0,t)})),et=n((()=>Ge.value.length<2)),tt=n((()=>{const e=Le.value.trim();return"reference"===He.value?!(!e&&!Ge.value.length):!!e}));o(He,(e=>{"reference"!==e&&(Ge.value=[])})),o(Ne,(e=>{Qe[e]||(Qe[e]=10)}));const lt=n((()=>`${Ke.width}×${Ke.height}px`)),at=x(),nt=s(),ot=e=>(z.push(e),$((()=>{var e;null==(e=qe.value)||e.scrollTo({top:qe.value.scrollHeight,behavior:"smooth"})})),e.id),st=(e,t)=>{const l=z.find((t=>t.id===e));l&&(l.content=t)},it=()=>!!et.value||(w.warning("引用区最多只能放 2 张图片"),!1),dt=e=>{Ge.value.unshift({...e,id:crypto.randomUUID()}),Ge.value=Ge.value.slice(0,2)},ct=()=>{var e;it()&&(null==(e=Ze.value)||e.click())},rt=async e=>{const t=e.target,l=null==t?void 0:t.files;if(l&&l[0])if(it()){We.value=!0;try{const{preview:e,remote:t,fileKey:a}=await pt(l[0]),n=Ge.value.some((e=>"template"===e.source)),o="reference"===He.value&&n?"base":"reference";dt({src:e,remote:t,title:l[0].name,kind:o,fileKey:a,source:"upload"})}catch(a){w.error(bt(a))}finally{We.value=!1,t&&(t.value="")}}else t.value=""},Et=()=>{const e=Xe.value;if(!e)return;const t=e.examples.length,l=Qe[e.id];l<t&&(Qe[e.id]=Math.min(l+10,t))},ut=async()=>{var t,l;const a=Le.value.trim();if(!a&&!Ge.value.length)return void w.warning("请输入内容或选择参考图");if(Te.value)return;Te.value=!0;const n=Ge.value.map((e=>({...e})));try{await ft(n),a&&ot({id:crypto.randomUUID(),role:"user",type:"text",content:a}),n.forEach((e=>{ot({id:crypto.randomUUID(),role:"user",type:"image",content:e.src})}));const o={prompt:a||"根据当前参考图片生成海报",references:n.filter((e=>"reference"===e.kind)).map((e=>e.remote)),base_images:n.filter((e=>"base"===e.kind)).map((e=>e.ossUrl||e.remote)),mode:He.value};"text"===He.value&&(o.width=Ke.width,o.height=Ke.height);const s=ot({id:crypto.randomUUID(),role:"ai",type:"loading",content:"正在提交任务..."}),i=await(t=>e("api/poster/tasks",t,"post",{},{timeout:18e4}))(o);if(!(0===i.code||200===i.code||1===i.stat)){st(s,i.message||"任务创建失败");const e=z.find((e=>e.id===s));throw e&&(e.type="text"),new Error(i.message||"任务创建失败")}const d=(null==(t=i.data)?void 0:t.image_urls)||i.image_urls;if(null==d?void 0:d.length){st(s,"生成完成，已返回预览。");const e=z.find((e=>e.id===s));return e&&(e.type="text"),d.forEach((e=>ot({id:crypto.randomUUID(),role:"ai",type:"image",content:e}))),Te.value=!1,void(Ge.value=[])}const c=null==(l=i.data)?void 0:l.task_id;if(!c){st(s,"系统异常：任务ID缺失");const e=z.find((e=>e.id===s));throw e&&(e.type="text"),new Error("任务ID缺失")}st(s,"正在排队中..."),mt(c,s)}catch(o){Te.value=!1,w.error(bt(o))}finally{Le.value=""}},pt=async t=>{const l=new FormData;l.append("file",t);const a=await e("api/files/upload",l,"post");if(!a||"success"!==a.status||!a.file_path)throw new Error((null==a?void 0:a.message)||"上传失败");return{preview:await At(t),remote:`${_}/api/files/${a.file_path}`,fileKey:a.file_path}},vt={in_queue:"前方排队中...",generating:"AI正在绘制...",processing:"努力生成中...",running:"正在处理细节...",pending:"等待调度..."},Bt=()=>{Je.value&&(window.clearTimeout(Je.value),Je.value=null)},mt=(t,l)=>{Bt();const a=async()=>{var n,o;try{const s=await(t=>e(`api/poster/tasks/${t}`,{},"get"))(t);if(0!==s.code)throw new Error(s.message||"查询失败");const i=(null==(n=s.data)?void 0:n.status)||"unknown";if(["done","success","finished"].includes(i)){st(l,"生成完成！");const e=z.find((e=>e.id===l));e&&(e.type="text");const t=(null==(o=s.data)?void 0:o.image_urls)||[];return t.length?t.forEach((e=>{ot({id:crypto.randomUUID(),role:"ai",type:"image",content:e})})):ot({id:crypto.randomUUID(),role:"ai",type:"text",content:"任务完成，但暂未获取到图片。"}),Te.value=!1,Ge.value=[],void Bt()}if(["failed","error","timeout"].includes(i)){st(l,"生成失败，请稍后重试。");const e=z.find((e=>e.id===l));return e&&(e.type="text"),Te.value=!1,void Bt()}st(l,vt[i]||`状态: ${i}`),Je.value=window.setTimeout(a,3e3)}catch(s){st(l,`查询失败：${bt(s)}`);const e=z.find((e=>e.id===l));e&&(e.type="text"),Te.value=!1,Bt()}};a()},At=e=>new Promise(((t,l)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=l,a.readAsDataURL(e)})),bt=e=>e instanceof Error?e.message:String(e),ft=async t=>{const l=t.filter((e=>"base"===e.kind&&!e.ossUrl&&e.fileKey));if(l.length)for(const a of l){const t=await e("api/files/upload-oss",{file_path:a.fileKey,remote_path:"poster/base"},"post");if(!t||"success"!==t.status||!t.oss_url)throw new Error((null==t?void 0:t.message)||"OSS上传失败");a.ossUrl=t.oss_url;const l=Ge.value.find((e=>e.id===a.id));l&&(l.ossUrl=t.oss_url)}},gt=e=>{if(!e)return e;return e.startsWith(_)||e.startsWith(window.location.origin)?e:e.startsWith("http")?`${_}/api/files/proxy?url=${encodeURIComponent(e)}`:e};return i((()=>{Bt()})),(e,t)=>{const l=p("el-icon"),a=p("el-tab-pane"),n=p("el-tabs"),o=p("el-button"),s=p("el-option"),i=p("el-select"),y=p("el-input-number"),U=p("el-popover"),_=p("el-input"),x=I("infinite-scroll");return c(),d("div",H,[r("aside",P,[S,E(n,{modelValue:Ne.value,"onUpdate:modelValue":t[0]||(t[0]=e=>Ne.value=e),class:"poster-tabs",stretch:""},{default:u((()=>[(c(!0),d(B,null,m(Me,(e=>(c(),h(a,{key:e.id,name:e.id,label:e.name},{default:u((()=>{var e;return[C((c(),d("div",K,[r("div",T,[(c(!0),d(B,null,m(Ye.value,(e=>(c(),d("div",{key:e.id,class:A(["example-card",{disabled:!et.value,active:Ge.value.some((t=>t.remote===e.cover))}]),onClick:t=>(e=>{var t;if("艺术字"===(null==(t=Xe.value)?void 0:t.id))return He.value="art",void(Le.value=e.prompt||e.title);if(!it())return;if("reference"!==He.value)return void w.warning("此模式下不需要参考图，请切换到参考图生成");Ge.value.some((e=>"template"===e.source))?w.warning("模板参考图只能选择一张，请上传底图"):dt({src:e.cover,remote:e.cover,title:e.title,kind:"reference",source:"template"})})(e)},[r("div",Z,[r("img",{src:e.cover,alt:e.title,loading:"lazy"},null,8,q),G]),r("p",J,b(e.title),1)],10,W)))),128))]),r("div",M,[Ye.value.length>=((null==(e=Xe.value)?void 0:e.examples.length)||0)?(c(),d("span",N," - 到底了 - ")):(c(),d("span",Q,[E(l,{class:"is-loading"},{default:u((()=>[E(D(F))])),_:1}),f(" 加载中... ")]))])])),[[x,Et]])]})),_:2},1032,["name","label"])))),128))])),_:1},8,["modelValue"])]),r("section",X,[r("div",{ref_key:"messageContainer",ref:qe,class:"messages"},[(c(!0),d(B,null,m(z,(e=>(c(),d("div",{key:e.id,class:A(["message",e.role])},["loading"===e.type?(c(),d("div",Y,[r("div",ee,[E(l,{class:"is-loading"},{default:u((()=>[E(D(F))])),_:1})]),r("div",te,[r("span",le,b(e.content),1),ae])])):"text"===e.type?(c(),d("div",ne,b(e.content),1)):(c(),d("div",oe,[r("div",se,[r("img",{src:e.content,alt:"chat image"},null,8,ie)]),r("div",de,[E(o,{class:"action-btn",icon:"Download",size:"small",plain:"",onClick:t=>(async e=>{try{const t=await fetch(gt(e)),l=await t.blob(),a=document.createElement("a");a.href=URL.createObjectURL(l),a.download=`poster-${Date.now()}.png`,a.click(),URL.revokeObjectURL(a.href)}catch(t){w.error(bt(t))}})(e.content)},{default:u((()=>[f(" 下载 ")])),_:2},1032,["onClick"]),E(o,{class:"action-btn",type:"primary",icon:"Plus",size:"small",onClick:t=>(async e=>{"Home"!==at.currentRoute.value.name&&await at.push({name:"Home"});const t=new Image;t.crossOrigin="anonymous",t.src=gt(e),t.onload=()=>{const l=JSON.parse(JSON.stringify(V));l.url=e,l.imgUrl=e,l.left=0,l.top=0,l.width=100,l.height=Math.round(t.height/t.width*100),nt.addWidget(l,{toTop:!0}),O.emit("closePosterGenerate"),w.success("已添加到画布")},t.onerror=()=>w.error("加载图片失败")})(e.content)},{default:u((()=>[f(" 添加到画布 ")])),_:2},1032,["onClick"])])]))],2)))),128))],512),"reference"===He.value?(c(),d("div",ce,[r("div",re,[r("div",null,[f("引用区 "),r("span",Ee,b(Ge.value.length)+"/"+b(2),1)]),ue]),Ge.value.length?(c(),d("div",pe,[(c(!0),d(B,null,m(Ge.value,(e=>(c(),d("div",{class:"reference-chip",key:e.id},[r("img",{src:e.src,alt:"reference"},null,8,ve),r("div",Be,[r("span",{class:A(["chip-label",e.kind])},b("reference"===e.kind?"引用":"底图"),3),r("span",me,b(e.title||"未命名图片"),1)]),r("div",{class:"chip-remove",onClick:g((t=>{return l=e.id,void(Ge.value=Ge.value.filter((e=>e.id!==l)));var l}),["stop"])},[E(l,null,{default:u((()=>[E(D(j))])),_:1})],8,Ae)])))),128))])):(c(),d("p",be,"从左侧模板或上传底图添加图片（最多两张）。"))])):v("",!0),r("div",fe,[r("div",ge,[he,r("div",we,[E(i,{modelValue:He.value,"onUpdate:modelValue":t[1]||(t[1]=e=>He.value=e),size:"small",class:"mode-select"},{default:u((()=>[(c(),d(B,null,m(ze,(e=>E(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"]),"text"===He.value?(c(),h(U,{key:0,placement:"bottom-start",trigger:"click",width:"360"},{reference:u((()=>[r("button",ye,[r("span",Ce,b(Ke.ratio),1),De,r("span",Fe,b(lt.value),1)])])),default:u((()=>[r("div",je,[r("div",ke,[Ue,r("div",_e,[(c(),d(B,null,m(Pe,(e=>E(o,{key:e,size:"small",type:e===Ke.ratio?"primary":"default",onClick:t=>(e=>{Ke.ratio=e,Se[e]&&(Ke.width=Se[e].width,Ke.height=Se[e].height)})(e)},{default:u((()=>[f(b(e),1)])),_:2},1032,["type","onClick"]))),64))])]),r("div",xe,[Ie,r("div",Ve,[E(y,{modelValue:Ke.width,"onUpdate:modelValue":t[2]||(t[2]=e=>Ke.width=e),min:256,max:4096},null,8,["modelValue"]),Oe,E(y,{modelValue:Ke.height,"onUpdate:modelValue":t[3]||(t[3]=e=>Ke.height=e),min:256,max:4096},null,8,["modelValue"])])])])])),_:1})):"reference"===He.value?(c(),h(o,{key:1,class:"upload-btn-outlined",loading:We.value,disabled:We.value||!et.value,onClick:ct},{default:u((()=>[E(l,null,{default:u((()=>[E(D(k))])),_:1}),f(" 上传图片 ")])),_:1},8,["loading","disabled"])):v("",!0)])]),r("div",$e,[E(_,{modelValue:Le.value,"onUpdate:modelValue":t[4]||(t[4]=e=>Le.value=e),type:"textarea",rows:3,class:"fixed-textarea",resize:"none",placeholder:"art"===He.value?"描述你想生成的艺术字效果":"描述你想要的海报或提出问题"},null,8,["modelValue","placeholder"])]),r("div",Re,[r("input",{ref_key:"imageInput",ref:Ze,class:"hidden-input",type:"file",accept:"image/*",onChange:rt},null,544),E(o,{type:"primary",onClick:ut,loading:Te.value,disabled:Te.value||!tt.value},{default:u((()=>[f(" 发送 ")])),_:1},8,["loading","disabled"])])])])])}}}),[["__scopeId","data-v-3d050c08"]]);export{Le as default};
