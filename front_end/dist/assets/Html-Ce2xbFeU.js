import{j as e,r as a,o as s,bO as t,cm as n,b_ as o,bQ as i,ck as d,cl as l,p as c,s as r,v as g,Q as u,X as m,O as p,cf as w,ac as f}from"./index-DIgVOHJd.js";import{P as v}from"./preload-Bq68wFsq.js";import{F as h}from"./fontfaceobserver.standalone-dB6e3PqD.js";const y={ref:"pageDesignIndex"},b={class:"page-design-index-wrap",id:"page-draw-html-wrap"},D=f(e({__name:"Html",setup(e){const f=o(),D=a([]);function C(e){let a=document.documentElement.clientWidth/e;return a=a>1?1:a,a}function I(){D.value=D.value.map((e=>(e.zoom=C(e.pageData.width),e)))}return s((()=>{t((()=>{!async function(){var e,a;let s="",n=!1;const{id:o,tempid:c}=f.query;if(o||c){const g={id:o||c},{data:u}=await i.home[o?"getWorks":"getTempDetail"](g);let m=JSON.parse(u);m=Array.isArray(m)?m:[m];for(let o=0;o<m.length;o++){const{global:i,layers:c}=m[o];let g={page:i,widgets:c};const u=g.widgets,p=C(null==(e=g.page)?void 0:e.width);s=null==(a=g.page)?void 0:a.backgroundImage,s&&delete g.page.backgroundImage,await t(),D.value.push({pageData:g.page,dWidgets:u,zoom:p});const w=[],f=[],y=[],b={};let I=[];if(u.forEach((e=>{if(e.fontClass&&e.fontClass.value){const a=new h(e.fontClass.value);I.push(e.fontClass),y.push(a.load(null,3e4)),b[e.fontClass.value]?b[e.fontClass.value]+=e.text:b[e.fontClass.value]=e.text}try{if(e.svgUrl&&"w-svg"===e.type){const a=window.document.getElementById(e.uuid).childNodes;f.push(a)}else if(e.imgUrl&&!e.isNinePatch){const a=window.document.getElementById(e.uuid).childNodes;for(const e of a)e.className&&e.className.includes("img__box")&&w.push(e.firstChild)}}catch(a){}})),s){const e=new v([s]);await e.imgs()}try{d&&await l(b,I);const e=new v(w);await e.doms();const a=new v(f);await a.svgs()}catch(r){}try{await Promise.all(y)}catch(r){}n=!0,setTimeout((()=>{try{window.loadFinishToInject("done")}catch(e){}}),100)}}setTimeout((()=>{!n&&window.loadFinishToInject("done")}),6e4)}(),window.addEventListener("resize",I,!1)}))})),n((()=>{window.removeEventListener("resize",I,!1)})),(e,a)=>(r(),c("div",y,[g("div",b,[(r(!0),c(u,null,m(D.value,(e=>(r(),p(w,{key:e.pageData.uuid,class:"page-design-wrap fixed-canvas",pageDesignCanvasId:"page-design-canvas",padding:0,renderDWdigets:e.dWidgets,renderDPage:e.pageData,zoom:100*e.zoom},null,8,["renderDWdigets","renderDPage","zoom"])))),128))])],512))}}),[["__scopeId","data-v-2c33bbcb"]]);export{D as default};
