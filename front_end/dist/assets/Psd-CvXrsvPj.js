import{co as e,cd as s,cp as a,j as t,cq as l,r as o,ac as n,p as r,s as c,A as d,q as i,B as u,bZ as p,v as f,W as g,Y as v,c3 as m,c4 as h,bN as _,a5 as w,Q as P,X as y,O as b,T as k,cr as D,cs as S,ct as C,c0 as F,bT as O,bP as U}from"./index-BO0Lm2fY.js";const $=`${s.API_URL}/api`,x=e=>`${$}/files/${encodeURIComponent(e)}`,I=t({name:"PSDUploader",components:{UploadFilled:l},emits:["processed"],setup(s,{emit:t}){const l=o(!1),n=o(0),r=o(""),c=o(null),d=o(null),i=o(""),u=async s=>{try{l.value=!0,r.value="Uploading file...",i.value="";const o=await(async(s,t={},l)=>{const o=new FormData;o.append("file",s),"boolean"==typeof t.skipOcr&&o.append("skip_ocr",String(t.skipOcr)),o.append("output_format",t.outputFormat||"png"),o.append("return_canvas","true");try{const s=await e(`${$}/psd/process`,o,"post",{},{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(l&&e.total){const s=Math.round(100*e.loaded/e.total);l(s)}}});if("error"===s.status)throw new Error(s.message||"Failed to process PSD file");return s}catch(n){throw a.error(n.message||"Failed to process PSD file"),n}})(s,{skipOcr:!1,outputFormat:"png"},(e=>{n.value=Math.min(90,e)}));r.value="Processing file...",n.value=95,await new Promise((e=>setTimeout(e,500))),c.value=o,n.value=100,i.value="success",r.value="Processing complete!",a.success("PSD processed successfully"),t("processed",o)}catch(o){i.value="exception",r.value="Error processing file: "+(o.message||"Unknown error"),a.error("Failed to process PSD: "+(o.message||"Unknown error"))}finally{l.value=!1}};return{processing:l,progress:n,progressStatus:i,statusMessage:r,result:c,handleFileChange:e=>{var s,t;l.value=!1,n.value=0,r.value="",c.value=null,i.value="";const o=(null==e?void 0:e.raw)||e;if(!o)return a.error("无法读取文件，请重试"),!1;const p=(null==(t=null==(s=o.name)?void 0:s.toLowerCase)?void 0:t.call(s))||"";return p.endsWith(".psd")||p.endsWith(".psb")?o.size>20971520?(a.error("File size should not exceed 20MB"),!1):(d.value=o,u(o),!1):(a.error("Only PSD files are supported"),!1)},downloadResult:()=>{var e,s;if(null==(e=c.value)?void 0:e.file_path){const e=((null==(s=d.value)?void 0:s.name)||"processed").replace(/\.(psd|psb)$/i,"_processed.png");((e,s)=>{try{const a=`${$}/psd/download/${encodeURIComponent(e)}`,t=document.createElement("a");t.href=a,t.download=s||e.split("/").pop()||"processed_file.png",document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(t){throw a.error(t.message||"Failed to download file"),t}})(c.value.file_path,e)}}}}}),M=e=>(m("data-v-5aaddd9d"),e=e(),h(),e),R={class:"psd-uploader"},W=M((()=>f("div",{class:"el-upload__text"},[v(" Drop PSD file here or "),f("em",null,"click to upload")],-1))),j=M((()=>f("div",{class:"el-upload__tip"}," Only PSD files with a size less than 20MB ",-1))),z={key:0,class:"processing-container"},N={class:"status-message"},T={key:1,class:"result-container"};const B=n(I,[["render",function(e,s,a,t,l,o){const n=p("upload-filled"),m=p("el-icon"),h=p("el-upload"),_=p("el-progress"),w=p("el-button"),P=p("el-result");return c(),r("div",R,[d(h,{class:"upload-demo",drag:"",action:"/","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":e.handleFileChange,accept:".psd,.psb"},{tip:u((()=>[j])),default:u((()=>[d(m,{class:"el-icon--upload"},{default:u((()=>[d(n)])),_:1}),W])),_:1},8,["on-change"]),e.processing?(c(),r("div",z,[d(_,{percentage:e.progress,status:e.progressStatus,"stroke-width":10},null,8,["percentage","status"]),f("div",N,g(e.statusMessage),1)])):i("",!0),e.result?(c(),r("div",T,[d(P,{icon:"success",title:"Processing Complete","sub-title":`File processed successfully: ${e.result.file_path}`},{extra:u((()=>[d(w,{type:"primary",onClick:e.downloadResult},{default:u((()=>[v(" Download Processed File ")])),_:1},8,["onClick"])])),_:1},8,["sub-title"])])):i("",!0)])}],["__scopeId","data-v-5aaddd9d"]]),E=e=>(m("data-v-3def59fd"),e=e(),h(),e),J={class:"psd-container"},q=E((()=>f("div",{class:"header"},[f("h1",null,"PSD 文件处理工具"),f("p",null,"上传 PSD 文件以移除文本图层并处理图像")],-1))),A={class:"content"},G={class:"features"},L=E((()=>f("h2",null,"功能特点",-1))),Q={class:"feature-icon"},X=n(t({__name:"Psd",setup(e){const s=[{title:"PSD 解析（后端）",description:"由后端统一解析与处理，结果可下载",component:D},{title:"智能去文字",description:"后端使用 OCR 检测并移除文本图层",component:S},{title:"多种格式导出",description:"支持 PNG、JPG 等图片格式导出",component:C}],a=F(),t=_(),l=w(),o={text:U,image:O};function n(e){try{const s=null==e?void 0:e.canvas;if(!s)return;const{width:n,height:r,background:c,clouds:d}=s;t.setDPage(Object.assign(t.dPage,{width:n,height:r,backgroundColor:(null==c?void 0:c.color)||"#ffffff00",backgroundImage:(null==c?void 0:c.image_url)?x(c.image_url):""})),l.setDWidgets([]);for(let e=0;e<((null==d?void 0:d.length)||0);e++){const s=d[e],a=JSON.parse(JSON.stringify(o[s.type]))||{};delete s.type,s.image_url&&(s.imgUrl=x(s.image_url)),l.addWidget(Object.assign(a,s))}a.push("/home")}catch(s){}}return(e,a)=>{const t=p("el-icon"),l=p("el-card"),o=p("el-col"),i=p("el-row");return c(),r("div",J,[q,f("div",A,[d(B,{onProcessed:n})]),f("div",G,[L,d(i,{gutter:20},{default:u((()=>[(c(),r(P,null,y(s,((e,s)=>d(o,{span:8,key:s},{default:u((()=>[d(l,{class:"feature-card"},{default:u((()=>[f("div",Q,[d(t,{size:32},{default:u((()=>[(c(),b(k(e.component)))])),_:2},1024)]),f("h3",null,g(e.title),1),f("p",null,g(e.description),1)])),_:2},1024)])),_:2},1024))),64))])),_:1})])])}}}),[["__scopeId","data-v-3def59fd"]]);export{X as default};
